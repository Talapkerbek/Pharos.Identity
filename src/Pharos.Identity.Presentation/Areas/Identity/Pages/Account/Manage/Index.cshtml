@page
@model IndexModel
@using Microsoft.Extensions.Localization
@using Pharos.Identity.Infra
@inject IStringLocalizer<SharedResource> Localizer

@{
    ViewData["Title"] = Localizer["Profile"];
    ViewData["ActivePage"] = ManageNavPages.Index;
}

<div class="w-full">
    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm w-full lg:w-[500px] px-5">

        <!-- Avatar preview -->
        <div class="flex justify-center">
            <div class="relative inline-block">
                <img id="avatar-preview"
                     src="@Model.Input.InitialAvatarPath"
                     alt="Avatar"
                     class="w-[120px] h-[120px] rounded-full object-cover shadow-md transition-transform duration-200 ease-in-out cursor-pointer hover:scale-105"
                     onerror="this.onerror=null; this.src='/imgs/user.svg';" />
            </div>
        </div>

        <!-- Profile form -->
        <form id="profile-form" method="post" enctype="multipart/form-data" class="flex flex-col gap-6">
            <input type="file" id="avatarInput" name="AvatarFile" accept="image/*" class="hidden" />

            <!-- First Name -->
            <div class="relative">
                <input asp-for="Input.FirstName"
                       class="peer w-full rounded-md border border-border bg-card px-3 pt-5 pb-2 text-card-foreground placeholder-transparent focus:ring-2 focus:ring-primary focus:outline-none"
                       placeholder="First Name" />
                <label asp-for="Input.FirstName"
                       class="absolute left-3 top-2 text-muted-foreground text-sm transition-all peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-sm peer-focus:text-primary">
                </label>
                <span asp-validation-for="Input.FirstName" class="text-destructive text-sm"></span>
            </div>

            <!-- Last Name -->
            <div class="relative">
                <input asp-for="Input.LastName"
                       class="peer w-full rounded-md border border-border bg-card px-3 pt-5 pb-2 text-card-foreground placeholder-transparent focus:ring-2 focus:ring-primary focus:outline-none"
                       placeholder="Last Name" />
                <label asp-for="Input.LastName"
                       class="absolute left-3 top-2 text-muted-foreground text-sm transition-all peer-placeholder-shown:top-5 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-sm peer-focus:text-primary">
                </label>
                <span asp-validation-for="Input.LastName" class="text-destructive text-sm"></span>
            </div>

            <!-- Save Button -->
            <button type="submit"
                    class="w-full py-3 px-4 bg-primary text-primary-foreground font-semibold rounded-md shadow-sm hover:bg-primary/90 hover:-translate-y-0.5 transition-all duration-200">
                @Localizer["Save"]
            </button>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const fileInput = document.getElementById('avatarInput');
        const preview = document.getElementById('avatar-preview');

        preview.addEventListener("click", () => fileInput.click());

        fileInput?.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => { preview.src = reader.result; };
            reader.readAsDataURL(file);
        });
    </script>
}
