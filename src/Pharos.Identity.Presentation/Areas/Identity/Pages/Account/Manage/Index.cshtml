@page
@using Microsoft.Extensions.Localization
@using Pharos.Identity.Infra
@model IndexModel
@inject IStringLocalizer<SharedResource> Localizer

@{
    ViewData["Title"] = Localizer["Profile"];
    ViewData["ActivePage"] = ManageNavPages.Index;
    var cardClasses = "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm";
}

<div class="w-full mx-auto">

<partial name="_StatusMessage" for="StatusMessage" />

<div class="@cardClasses w-full lg:w-[500px] px-5">

    <!-- Avatar preview -->
    <div style="text-align: center;">
        <div style="position: relative; display: inline-block;">
            <img id="avatar-preview"
                 src="@Model.Input.InitialAvatarPath"
                 alt="Avatar"
                 style="
                     width: 120px;
                     height: 120px;
                     border-radius: 50%;
                     object-fit: cover;
                     box-shadow: 0 2px 6px rgba(0,0,0,0.15);
                     transition: transform 0.2s ease;
                     cursor: pointer;
                 "
                 onmouseover="this.style.transform='scale(1.05)'"
                 onmouseout="this.style.transform='scale(1)'"
            />
        </div>

        
    </div>

    <!-- Profile form -->
    <form id="profile-form"
          method="post"
          enctype="multipart/form-data"
          style="display: flex; flex-direction: column; gap: 18px; width: 100%;">

        <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"
             style="color: #d9534f; font-size: 14px;"></div>
        
        <input type="file"
               id="avatarInput"
               name="AvatarFile"
               accept="image/*"
               style="display:none;" />

        <div style="display: flex; flex-direction: column; gap: 6px;">
            <label asp-for="Input.FirstName" style="font-weight: 600; font-size: 15px;"></label>
            <input asp-for="Input.FirstName"
                   style="
                       padding: 10px 12px;
                       border: 1px solid #ccc;
                       border-radius: 8px;
                       font-size: 14px;
                       transition: border-color 0.2s;
                   "
                   onfocus="this.style.borderColor='#007bff'"
                   onblur="this.style.borderColor='#ccc'" />
            <span asp-validation-for="Input.FirstName" style="color: #d9534f; font-size: 13px;"></span>
        </div>

        <div style="display: flex; flex-direction: column; gap: 6px;">
            <label asp-for="Input.LastName" style="font-weight: 600; font-size: 15px;"></label>
            <input asp-for="Input.LastName"
                   style="
                       padding: 10px 12px;
                       border: 1px solid #ccc;
                       border-radius: 8px;
                       font-size: 14px;
                       transition: border-color 0.2s;
                   "
                   onfocus="this.style.borderColor='#007bff'"
                   onblur="this.style.borderColor='#ccc'" />
            <span asp-validation-for="Input.LastName" style="color: #d9534f; font-size: 13px;"></span>
        </div>

        <button id="update-profile-button"
                type="submit"
                style="
                    width: 100%;
                    padding: 12px;
                    background-color: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 15px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: background-color 0.25s ease, transform 0.15s ease;
                "
                onmouseover="this.style.backgroundColor='#0056b3'; this.style.transform='translateY(-1px)'"
                onmouseout="this.style.backgroundColor='#007bff'; this.style.transform='none'">
            @Localizer["Save"]
        </button>
    </form>
</div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const fileInput = document.getElementById('avatarInput');
        const preview = document.getElementById('avatar-preview');
        
        preview.addEventListener("click", (event) => {
            fileInput.click()
        })
        
        fileInput?.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => { preview.src = reader.result; };
            reader.readAsDataURL(file);
        });
    </script>
}
