@using System.Security.Claims
@using Microsoft.Extensions.Localization
@using Pharos.Identity.Infra
@using Pharos.Identity.Infra.Data

@inject IStringLocalizer<SharedResource> Localizer
@inject SignInManager<ApplicationUser> SignInManager

<ul class="flex items-center gap-4">
    <li>
        <a href="/Identity/Account/Manage"
           class="block px-4 py-2 rounded-md bg-card text-foreground font-medium hover:bg-accent hover:text-accent-foreground transition-colors duration-200 min-w-[180px] text-center">
            @(User.FindFirstValue("FirstName") + " " + User.FindFirstValue("LastName"))
        </a>
    </li>

    @if (SignInManager.IsSignedIn(User))
    {
        <li>
            <form id="logoutForm" class="inline" asp-area="Identity" asp-page="/Account/Logout">
                <button id="logout"
                        type="submit"
                        class="cursor-pointer px-4 py-2 rounded-md bg-secondary text-secondary-foreground font-medium hover:bg-secondary/80 transition-colors duration-200 min-w-[160px]">
                    @Localizer["Logout"]
                </button>
            </form>
        </li>
    }
    else
    {
        <li>
            <a class="inline-block px-4 py-2 rounded-md bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-colors duration-200 min-w-[140px] text-center"
               id="login"
               asp-area="Identity"
               asp-page="/Account/Login">
                @Localizer["Login"]
            </a>
        </li>
    }

    <li>
        <select id="languageSelect"
                onchange="handleLanguageChange(event)"
                class="rounded-md border border-border bg-card text-foreground px-3 py-2 min-w-[120px] focus:outline-none focus:ring-2 focus:ring-primary transition">
            <option class="text-foreground bg-card" value="default">Language</option>
            <option class="text-foreground bg-card" value="en">English</option>
            <option class="text-foreground bg-card" value="ru">Русский</option>
            <option class="text-foreground bg-card" value="kk">Қазақша</option>
        </select>
    </li>
</ul>

<script>
    function handleLanguageChange(e) {
        const lang = e.target.value;
        if (lang === "default") return;

        localStorage.setItem("culture", lang);
        document.cookie = `.AspNetCore.Culture=c=${lang}|uic=${lang}; path=/`;
        window.location.reload();
    }
</script>

<script>
    function handleLanguageChange(e) {
        const lang = e.target.value;
        if (lang === "default") return;

        localStorage.setItem("culture", lang);
        document.cookie = `.AspNetCore.Culture=c=${lang}|uic=${lang}; path=/`;
        window.location.reload();
    }
</script>